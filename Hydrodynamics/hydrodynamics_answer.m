% ===================================================
% ПРАВИЛЬНОЕ ЧИСЛЕННОЕ РЕШЕНИЕ МЕТОДОМ КОНТРОЛЬНОГО ОБЪЕМА
% Узлы: x=0,2,4,6; неизвестные: T(2), T(4)
% ===================================================

clear; clc; close all;

% ========== 1. АНАЛИТИЧЕСКОЕ РЕШЕНИЕ ==========
x_analyt = linspace(0, 6, 100);
T_analyt = x_analyt.^2 - 6 * x_analyt;

% ========== 2. ЧИСЛЕННОЕ РЕШЕНИЕ ==========
h = 2;
n = 2; % два внутренних узла: x=2, x=4

a = [0; 1];   % a(i) - коэффициент при T_{i-1}
b = [-2; -2]; % b(i) - коэффициент при T_i
c = [1; 0];   % c(i) - коэффициент при T_{i+1}
d = [8; 8];   % правая часть (4*h = 8)

% ========== 3. РЕШЕНИЕ TDMA ==========
function T = tdma(a, b, c, d)
    n = length(b);
    p = zeros(n,1);
    q = zeros(n,1);

    p(1) = c(1) / b(1);
    q(1) = d(1) / b(1);

    for i = 2:n-1
        denom = b(i) - a(i)*p(i-1);
        p(i) = c(i) / denom;
        q(i) = (d(i) - a(i)*q(i-1)) / denom;
    end

    T(n) = (d(n) - a(n)*q(n-1)) / (b(n) - a(n)*p(n-1));
    for i = n-1:-1:1
        T(i) = q(i) - p(i)*T(i+1);
    end
end

T_num = tdma(a, b, c, d);

% Узлы численного решения
x_num = [2, 4];

% ========== 4. СРАВНЕНИЕ ==========
T_analyt_at_nodes = x_num.^2 - 6 * x_num;

fprintf('==================================================\n');
fprintf('ЧИСЛЕННОЕ РЕШЕНИЕ (узлы x=2,4):\n');
for i = 1:n
    fprintf('T(%g) = %.6f\n', x_num(i), T_num(i));
end

fprintf('\nАНАЛИТИЧЕСКОЕ РЕШЕНИЕ:\n');
for i = 1:n
    fprintf('T(%g) = %.6f\n', x_num(i), T_analyt_at_nodes(i));
end

fprintf('\nПОГРЕШНОСТЬ:\n');
for i = 1:n
    err = abs(T_num(i) - T_analyt_at_nodes(i));
    fprintf('Ошибка в точке x=%g: %.2e\n', x_num(i), err);
end

% ========== 5. ГРАФИК ==========
figure;
plot(x_analyt, T_analyt, 'b-', 'LineWidth', 2, 'DisplayName', 'Аналитическое');
hold on;
plot(x_num, T_num, 'ro', 'MarkerSize', 8, 'MarkerFaceColor', 'r', 'DisplayName', 'Численное');
grid on;
xlabel('x');
ylabel('T(x)');
title('Сравнение численного и аналитического решения (узлы 2,4)');
legend('Location', 'best');
xlim([0 6]);
ylim([-10 0]);

% ========== 6. ВЫВОД ==========
fprintf('\n==================================================\n');
fprintf('ВЫВОД:\n');
fprintf('1. Численное решение получено для узлов x=2 и x=4.\n');
fprintf('2. СЛАУ решена методом прогонки.\n');
fprintf('3. Аналитическое решение: T(x) = x^2 - 6x.\n');
fprintf('4. На узлах x=2 и x=4 численное решение точно совпадает с аналитическим.\n');
fprintf('5. Это ожидаемо, так как метод конечных разностей (центральные разности) точен для полиномов степени <=2.\n');
fprintf('==================================================\n');
